#!/usr/bin/env bash

# shellcheck disable=SC2120,SC1090,SC2124

VAULT_CONFIG_FILE=~/.vault-configuration

source "$CLI_DIR/tc/framework/functions"

function vault_get_token()  {
  tcctl helpers check_bin_file --filename vault
  source $VAULT_CONFIG_FILE
  __output=$( vault login -method=userpass username="$VAULT_NAME" password="$VAULT_PASSWORD" )
  _error_code=$?
  __MSG="Command: tcctl vault token $@ "
  __MSG+="$__output"
  if [ "$_error_code" -eq "0" ]; then
    VAULT_TOKEN=$( echo "$__output" | sed 1,6d | tr -s ' ' | cut -f 2 -d ' ' | sed -n 1p )
    echo "$VAULT_TOKEN"
  else
    _message "$__MSG" "error" "$_error_code"
  fi
}

vault_get_token
